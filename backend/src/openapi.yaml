openapi: 3.0.3
info:
  title: Momento API
  description: í”„ë¡œì íŠ¸ ê´€ë¦¬ ë° ìŠ¤í„°ë”” ì„¸ì…˜ ì¶”ì  ì•± API
  version: 1.0.0
  contact:
    name: Momento Team

servers:
  - url: http://localhost:3000/api
    description: Development
  - url: http://172.10.5.61:3000/api
    description: Production

tags:
  - name: Users
    description: ì‚¬ìš©ì ê´€ë¦¬
  - name: Projects
    description: í”„ë¡œì íŠ¸ ê´€ë¦¬
  - name: Project Members
    description: í”„ë¡œì íŠ¸ ë©¤ë²„ ê´€ë¦¬
  - name: Checklists
    description: ì²´í¬ë¦¬ìŠ¤íŠ¸(Task) ê´€ë¦¬
  - name: Time Logs
    description: ì‹œê°„ ê¸°ë¡ ê´€ë¦¬
  - name: Locations
    description: ìŠ¤í„°ë”” ì¥ì†Œ ê´€ë¦¬
  - name: Study Sessions
    description: ìŠ¤í„°ë”” ì„¸ì…˜ ì°¸ê°€/í‡´ì¥
  - name: Receipts
    description: ì¼ì¼ ì˜ìˆ˜ì¦ ê´€ë¦¬

security:
  - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Firebase ID Token
      description: Firebase Authentication ID Token

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        firebaseUid:
          type: string
        nickname:
          type: string
        profileEmoji:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserSearchResult:
      type: object
      properties:
        id:
          type: string
          format: uuid
        nickname:
          type: string
        profileEmoji:
          type: string

    CreateUserDto:
      type: object
      required:
        - nickname
      properties:
        nickname:
          type: string
          example: ì‚¬ìš©ìë‹‰ë„¤ì„
        profileEmoji:
          type: string
          example: "ğŸ˜€"

    UpdateUserDto:
      type: object
      properties:
        nickname:
          type: string
        profileEmoji:
          type: string

    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        coverImageUrl:
          type: string
          nullable: true
        plannedStartDate:
          type: string
          format: date
        plannedEndDate:
          type: string
          format: date
        status:
          type: string
          enum: [ACTIVE, PENDING_REVIEW, COMPLETED]
        rating:
          type: integer
          minimum: 1
          maximum: 5
          nullable: true
        completedAt:
          type: string
          format: date-time
          nullable: true
        memberCount:
          type: integer
        completedChecklistCount:
          type: integer
        totalChecklistCount:
          type: integer
        totalTimeMinutes:
          type: integer
        createdAt:
          type: string
          format: date-time

    ProjectDetail:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        coverImageUrl:
          type: string
          nullable: true
        plannedStartDate:
          type: string
          format: date
        plannedEndDate:
          type: string
          format: date
        rating:
          type: integer
          nullable: true
        members:
          type: array
          items:
            $ref: '#/components/schemas/ProjectMember'
        checklists:
          type: array
          items:
            $ref: '#/components/schemas/Checklist'
        createdAt:
          type: string
          format: date-time

    ProjectMember:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        nickname:
          type: string
        profileEmoji:
          type: string
        role:
          type: string
          enum: [owner, member]

    CreateProjectDto:
      type: object
      required:
        - title
        - plannedStartDate
        - plannedEndDate
      properties:
        title:
          type: string
          example: í”„ë¡œì íŠ¸ ì œëª©
        coverImageUrl:
          type: string
          nullable: true
        plannedStartDate:
          type: string
          format: date
          example: "2025-01-01"
        plannedEndDate:
          type: string
          format: date
          example: "2025-01-31"
        memberNicknames:
          type: array
          items:
            type: string
          description: í˜‘ì—… í”„ë¡œì íŠ¸ì¸ ê²½ìš° íŒ€ì› ë‹‰ë„¤ì„ ë°°ì—´

    UpdateProjectDto:
      type: object
      properties:
        title:
          type: string
        coverImageUrl:
          type: string
        plannedStartDate:
          type: string
          format: date
        plannedEndDate:
          type: string
          format: date
        rating:
          type: integer
          minimum: 1
          maximum: 5

    CompleteProjectDto:
      type: object
      required:
        - rating
      properties:
        rating:
          type: integer
          minimum: 1
          maximum: 5

    AddMemberDto:
      type: object
      required:
        - userId
      properties:
        userId:
          type: string
          format: uuid
        role:
          type: string
          enum: [member]
          default: member

    Checklist:
      type: object
      properties:
        id:
          type: string
          format: uuid
        content:
          type: string
        isCompleted:
          type: boolean
        assigneeId:
          type: string
          format: uuid
          nullable: true
        assigneeNickname:
          type: string
          nullable: true
        displayOrder:
          type: integer
        totalTimeMinutes:
          type: integer

    CreateChecklistDto:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          example: ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ë‚´ìš©
        assigneeId:
          type: string
          format: uuid
        displayOrder:
          type: integer
          default: 0

    UpdateChecklistDto:
      type: object
      properties:
        content:
          type: string
        isCompleted:
          type: boolean
        assigneeId:
          type: string
          format: uuid
        displayOrder:
          type: integer

    TimeLog:
      type: object
      properties:
        id:
          type: string
          format: uuid
        checklistId:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        startedAt:
          type: string
          format: date-time
        endedAt:
          type: string
          format: date-time
          nullable: true
        durationMinutes:
          type: integer
          nullable: true

    TodaySummary:
      type: object
      properties:
        date:
          type: string
          format: date
        totalMinutes:
          type: integer
        completedTasksCount:
          type: integer
        projects:
          type: array
          items:
            type: object
            properties:
              projectId:
                type: string
                format: uuid
              projectTitle:
                type: string
              minutes:
                type: integer
              completedTasksCount:
                type: integer
        timeLogs:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              checklistId:
                type: string
                format: uuid
              checklistContent:
                type: string
              projectId:
                type: string
                format: uuid
              projectTitle:
                type: string
              startedAt:
                type: string
                format: date-time
              endedAt:
                type: string
                format: date-time
              durationMinutes:
                type: integer
        completedTasks:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              content:
                type: string
              projectId:
                type: string
                format: uuid
              projectTitle:
                type: string
              completedAt:
                type: string
                format: date-time
              totalTimeMinutes:
                type: integer

    Location:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string

    CreateLocationDto:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          example: N1 ë„ì„œê´€

    LocationParticipants:
      type: object
      properties:
        location:
          $ref: '#/components/schemas/Location'
        participants:
          type: array
          items:
            type: object
            properties:
              userId:
                type: string
                format: uuid
              nickname:
                type: string
              profileEmoji:
                type: string
              currentProject:
                type: string
                nullable: true
              todayTotalMinutes:
                type: integer
              joinedAt:
                type: string
                format: date-time

    StudySession:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        locationId:
          type: string
          format: uuid
        joinedAt:
          type: string
          format: date-time
        leftAt:
          type: string
          format: date-time
          nullable: true

    Receipt:
      type: object
      properties:
        id:
          type: string
          format: uuid
        date:
          type: string
          format: date
        imageUrl:
          type: string
        totalMinutes:
          type: integer
        completedTasksCount:
          type: integer
        createdAt:
          type: string
          format: date-time

    CreateReceiptDto:
      type: object
      required:
        - date
        - imageUrl
      properties:
        date:
          type: string
          format: date
          example: "2025-01-10"
        imageUrl:
          type: string

    PaginatedResponse:
      type: object
      properties:
        data:
          type: array
          items: {}
        meta:
          type: object
          properties:
            total:
              type: integer
            page:
              type: integer
            limit:
              type: integer

    Error:
      type: object
      properties:
        statusCode:
          type: integer
        message:
          type: string
        error:
          type: string

paths:
  # ===== Users =====
  /users/me:
    get:
      tags: [Users]
      summary: ë‚´ ì •ë³´ ì¡°íšŒ
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤

    patch:
      tags: [Users]
      summary: ë‚´ ì •ë³´ ìˆ˜ì •
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserDto'
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /users:
    post:
      tags: [Users]
      summary: íšŒì›ê°€ì… (ìµœì´ˆ ë¡œê·¸ì¸ ì‹œ)
      description: firebaseUidëŠ” Authorization í—¤ë”ì˜ Firebase ID Tokenì—ì„œ ì„œë²„ê°€ ìë™ ì¶”ì¶œí•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserDto'
      responses:
        '201':
          description: ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /users/search:
    get:
      tags: [Users]
      summary: ë‹‰ë„¤ì„ìœ¼ë¡œ ì‚¬ìš©ì ê²€ìƒ‰
      description: UI ìë™ì™„ì„±/ì‹¤ì‹œê°„ ê²€ì¦ìš©
      parameters:
        - name: nickname
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSearchResult'
        '404':
          description: ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤

  # ===== Projects =====
  /projects/current:
    get:
      tags: [Projects]
      summary: ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ ì¡°íšŒ
      description: statusê°€ ACTIVE ë˜ëŠ” PENDING_REVIEWì¸ í”„ë¡œì íŠ¸
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Project'

  /projects/past:
    get:
      tags: [Projects]
      summary: ì™„ë£Œëœ í”„ë¡œì íŠ¸ ì¡°íšŒ
      description: statusê°€ COMPLETEDì¸ í”„ë¡œì íŠ¸ë§Œ ë°˜í™˜ (ë³´ê³ ì„œ íƒ­)
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Project'

  /projects:
    post:
      tags: [Projects]
      summary: í”„ë¡œì íŠ¸ ìƒì„±
      description: |
        ê°œì¸ í”„ë¡œì íŠ¸: memberNicknames ìƒëµ ë˜ëŠ” ë¹ˆ ë°°ì—´ â†’ ìƒì„±ìë§Œ ë©¤ë²„ë¡œ ì¶”ê°€
        í˜‘ì—… í”„ë¡œì íŠ¸: memberNicknamesì— í•¨ê»˜í•  ì‚¬ìš©ì ë‹‰ë„¤ì„ ë°°ì—´ ì „ë‹¬
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectDto'
      responses:
        '201':
          description: ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDetail'
        '404':
          description: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë‹‰ë„¤ì„

  /projects/{id}:
    get:
      tags: [Projects]
      summary: í”„ë¡œì íŠ¸ ìƒì„¸ ì¡°íšŒ
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDetail'
        '404':
          description: í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤

    patch:
      tags: [Projects]
      summary: í”„ë¡œì íŠ¸ ìˆ˜ì •
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectDto'
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDetail'

    delete:
      tags: [Projects]
      summary: í”„ë¡œì íŠ¸ ì‚­ì œ
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: ì‚­ì œ ì„±ê³µ

  /projects/{id}/complete:
    post:
      tags: [Projects]
      summary: í”„ë¡œì íŠ¸ ì™„ë£Œ (ë³´ê³ ì„œ ì‘ì„±)
      description: í”„ë¡œì íŠ¸ë¥¼ ì™„ë£Œ ì²˜ë¦¬í•˜ê³  ë³´ê³ ì„œ(í‰ì )ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompleteProjectDto'
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  title:
                    type: string
                  rating:
                    type: integer
                  completedAt:
                    type: string
                    format: date-time
                  totalTimeMinutes:
                    type: integer
                  message:
                    type: string
        '400':
          description: ì´ë¯¸ ì™„ë£Œëœ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤

  # ===== Project Members =====
  /projects/{projectId}/members:
    post:
      tags: [Project Members]
      summary: ë©¤ë²„ ì¶”ê°€
      description: ë¨¼ì € GET /api/users/search?nickname=...ìœ¼ë¡œ ì‚¬ìš©ìë¥¼ ê²€ìƒ‰í•œ í›„, í•´ë‹¹ userIdë¡œ ë©¤ë²„ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddMemberDto'
      responses:
        '201':
          description: ì¶”ê°€ ì„±ê³µ

  /projects/{projectId}/members/{userId}:
    delete:
      tags: [Project Members]
      summary: ë©¤ë²„ ì‚­ì œ
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: ì‚­ì œ ì„±ê³µ

  # ===== Checklists =====
  /projects/{projectId}/checklists:
    post:
      tags: [Checklists]
      summary: ì²´í¬ë¦¬ìŠ¤íŠ¸ ì¶”ê°€
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChecklistDto'
      responses:
        '201':
          description: ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Checklist'

  /checklists/{id}:
    patch:
      tags: [Checklists]
      summary: ì²´í¬ë¦¬ìŠ¤íŠ¸ ìˆ˜ì •
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateChecklistDto'
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Checklist'

    delete:
      tags: [Checklists]
      summary: ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‚­ì œ
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: ì‚­ì œ ì„±ê³µ

  # ===== Time Logs =====
  /checklists/{checklistId}/time-logs/start:
    post:
      tags: [Time Logs]
      summary: íƒ€ì´ë¨¸ ì‹œì‘
      parameters:
        - name: checklistId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '201':
          description: ì‹œì‘ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimeLog'

  /time-logs/{id}/stop:
    post:
      tags: [Time Logs]
      summary: íƒ€ì´ë¨¸ ì •ì§€
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ì •ì§€ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimeLog'

  /time-logs/today:
    get:
      tags: [Time Logs]
      summary: ì˜¤ëŠ˜ í™œë™ ìš”ì•½ ì¡°íšŒ
      description: ì˜¤ëŠ˜ì˜ ëª¨ë“  í™œë™ ê¸°ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤. ë©”ì¸ íƒ­ í‘œì‹œ ë° ì¼ì¼ ì˜ìˆ˜ì¦ ìƒì„±ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodaySummary'

  # ===== Locations =====
  /locations:
    get:
      tags: [Locations]
      summary: ì¥ì†Œ ëª©ë¡ ì¡°íšŒ
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Location'

    post:
      tags: [Locations]
      summary: ì¥ì†Œ ìƒì„±
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLocationDto'
      responses:
        '201':
          description: ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Location'

  /locations/{locationId}/participants:
    get:
      tags: [Locations]
      summary: íŠ¹ì • ì¥ì†Œì˜ ì°¸ê°€ì ì¡°íšŒ
      parameters:
        - name: locationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocationParticipants'

  # ===== Study Sessions =====
  /locations/{locationId}/join:
    post:
      tags: [Study Sessions]
      summary: ìŠ¤í„°ë”” ì„¸ì…˜ ì°¸ê°€
      parameters:
        - name: locationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '201':
          description: ì°¸ê°€ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudySession'

  /study-sessions/{id}/leave:
    post:
      tags: [Study Sessions]
      summary: ìŠ¤í„°ë”” ì„¸ì…˜ í‡´ì¥
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: í‡´ì¥ ì„±ê³µ

  # ===== Receipts =====
  /receipts:
    get:
      tags: [Receipts]
      summary: ì˜ìˆ˜ì¦ ëª©ë¡ ì¡°íšŒ (ì•„ì¹´ì´ë¸Œ íƒ­)
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Receipt'

    post:
      tags: [Receipts]
      summary: ì˜ìˆ˜ì¦ ìƒì„±/ê°±ì‹ 
      description: ìƒˆ ì˜ìˆ˜ì¦ì„ ìƒì„±í•˜ê±°ë‚˜, í•´ë‹¹ ë‚ ì§œì˜ ì˜ìˆ˜ì¦ì´ ì´ë¯¸ ìˆìœ¼ë©´ ê°±ì‹ í•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReceiptDto'
      responses:
        '201':
          description: ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Receipt'
        '200':
          description: ê°±ì‹  ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Receipt'

  /receipts/{date}:
    get:
      tags: [Receipts]
      summary: íŠ¹ì • ë‚ ì§œ ì˜ìˆ˜ì¦ ì¡°íšŒ
      parameters:
        - name: date
          in: path
          required: true
          description: ì¡°íšŒí•  ë‚ ì§œ (YYYY-MM-DD í˜•ì‹)
          schema:
            type: string
            format: date
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Receipt'
        '404':
          description: í•´ë‹¹ ë‚ ì§œì˜ ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤

    delete:
      tags: [Receipts]
      summary: ì˜ìˆ˜ì¦ ì‚­ì œ
      parameters:
        - name: date
          in: path
          required: true
          schema:
            type: string
            format: date
      responses:
        '204':
          description: ì‚­ì œ ì„±ê³µ
